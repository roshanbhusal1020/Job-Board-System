<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Job Board</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f5f5f5;
      line-height: 1.6;
      color: #333;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 2rem 0;
      margin-bottom: 2rem;
      border-radius: 10px;
      text-align: center;
    }

    .header h1 {
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
    }

    .user-info {
      background: white;
      padding: 1rem;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 2rem;
    }

    .form-section {
      background: white;
      padding: 2rem;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 2rem;
    }

    .form-section h2 {
      color: #667eea;
      margin-bottom: 1.5rem;
      font-size: 1.5rem;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: #555;
    }

    input, textarea, select {
      width: 100%;
      padding: 12px;
      border: 2px solid #ddd;
      border-radius: 6px;
      font-size: 1rem;
      transition: border-color 0.3s ease;
    }

    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    textarea {
      resize: vertical;
      min-height: 120px;
    }

    .btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 12px 30px;
      border: none;
      border-radius: 6px;
      font-size: 1rem;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      font-weight: 600;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .loading {
      display: none;
      text-align: center;
      padding: 1rem;
      color: #667eea;
    }

    .message {
      padding: 1rem;
      border-radius: 6px;
      margin-bottom: 1rem;
      display: none;
    }

    .success {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .error {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .search-link {
      display: inline-block;
      background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
      color: white;
      padding: 12px 24px;
      text-decoration: none;
      border-radius: 6px;
      font-weight: 600;
      transition: transform 0.2s ease;
    }

    .search-link:hover {
      transform: translateY(-2px);
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    @media (max-width: 768px) {
      .form-row {
        grid-template-columns: 1fr;
      }
      
      .container {
        padding: 10px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Job Board Dashboard</h1>
      <p>Manage your profile and job postings</p>
    </div>

    <div id="userInfo" class="user-info"></div>

    <div class="form-section">
      <h2>Update Profile</h2>
      <div id="profileMessage" class="message"></div>
      <div id="profileLoading" class="loading">Updating profile...</div>
      
      <form id="updateProfile">
        <div class="form-row">
          <div class="form-group">
            <label for="updateName">Full Name *</label>
            <input type="text" id="updateName" required>
          </div>
          <div class="form-group">
            <label for="updateEmail">Email Address *</label>
            <input type="email" id="updateEmail" required>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="updatePin">PIN *</label>
            <input type="number" id="updatePin" required min="1000" max="9999">
          </div>
          <div class="form-group">
            <label for="updateRole">Role *</label>
            <select id="updateRole" required>
              <option value="">Select Role</option>
            </select>
          </div>
        </div>
        
        <div class="form-group">
          <label for="updateResume">Resume/Bio</label>
          <textarea id="updateResume" placeholder="Enter your resume or bio..."></textarea>
        </div>

        <button type="submit" class="btn">Update Profile</button>
      </form>
    </div>

    <div class="form-section">
      <h2>Create New Job</h2>
      <div id="jobMessage" class="message"></div>
      <div id="jobLoading" class="loading">Creating job...</div>
      
      <form id="createJob">
        <div class="form-row">
          <div class="form-group">
            <label for="jobTitle">Job Title *</label>
            <input type="text" id="jobTitle" required>
          </div>
          <div class="form-group">
            <label for="jobCompany">Company Name *</label>
            <input type="text" id="jobCompany" required>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="jobLocation">Job Location *</label>
            <input type="text" id="jobLocation" required>
          </div>
          <div class="form-group">
            <label for="updateJobStatus">Job Status *</label>
            <select id="updateJobStatus" required>
              <option value="">Select Status</option>
            </select>
          </div>
        </div>
        
        <div class="form-group">
          <label for="jobDescription">Job Description *</label>
          <textarea id="jobDescription" required placeholder="Enter detailed job description..."></textarea>
        </div>

        <button type="submit" class="btn">Create Job</button>
      </form>
    </div>

    <div class="form-section">
      <h2>Quick Actions</h2>
      <a href="#" class="search-link">üîç Search Jobs</a>
    </div>
  </div>


<script>
// Configuration
const AUTH_URL = "http://localhost:8080/auth";
const URL = "http://localhost:8080";

// Utility functions
function showMessage(elementId, message, type = 'error') {
  const messageElement = document.getElementById(elementId);
  messageElement.textContent = message;
  messageElement.className = `message ${type}`;
  messageElement.style.display = 'block';
  
  // Auto-hide after 5 seconds
  setTimeout(() => {
    messageElement.style.display = 'none';
  }, 5000);
}

function showLoading(elementId, show = true) {
  const loadingElement = document.getElementById(elementId);
  loadingElement.style.display = show ? 'block' : 'none';
}

function setFormEnabled(formId, enabled = true) {
  const form = document.getElementById(formId);
  const inputs = form.querySelectorAll('input, textarea, select, button');
  inputs.forEach(input => {
    input.disabled = !enabled;
  });
}

// API functions with error handling
async function apiRequest(url, options = {}) {
  try {
    const response = await fetch(url, {
      credentials: "include",
      ...options
    });
    
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    
    return response;
  } catch (error) {
    console.error('API request failed:', error);
    throw error;
  }
}

async function getUserDetails() {
  try {
    const response = await apiRequest(`${AUTH_URL}/userDetails`);
    const text = await response.text();
    
    try {
      const user = JSON.parse(text);
      console.log('User details loaded:', user);
      
      if (user && user.name) {
        document.getElementById("userInfo").innerHTML = `
          <strong>Welcome back, ${user.name}!</strong><br>
          <small>Email: ${user.email} | Role: ${user.userRole}</small>
        `;
        
        // Populate form fields
        document.getElementById("updateName").value = user.name || '';
        document.getElementById("updateEmail").value = user.email || '';
        document.getElementById("updatePin").value = user.pin || '';
        document.getElementById("updateResume").value = user.resume || '';
        document.getElementById("updateRole").value = user.userRole || '';
      } else {
        document.getElementById("userInfo").innerHTML = '<span style="color: #dc3545;">No user information found.</span>';
      }
    } catch (parseError) {
      console.warn("Could not parse user details:", text);
      document.getElementById("userInfo").innerHTML = '<span style="color: #dc3545;">Not logged in or session expired.</span>';
    }
  } catch (error) {
    console.error('Failed to load user details:', error);
    document.getElementById("userInfo").innerHTML = '<span style="color: #dc3545;">Failed to load user information.</span>';
  }
}

async function getUserRoles() {
  try {
    const response = await apiRequest(`${AUTH_URL}/roles`);
    const roles = await response.json();
    const roleDropdown = document.getElementById("updateRole");
    
    // Clear existing options (except first one)
    roleDropdown.innerHTML = '<option value="">Select Role</option>';
    
    roles.forEach(role => {
      const option = document.createElement("option");
      option.value = role;
      option.textContent = role;
      roleDropdown.appendChild(option);
    });
  } catch (error) {
    console.error('Failed to load roles:', error);
    showMessage('profileMessage', 'Failed to load user roles. Please refresh the page.');
  }
}

async function getJobStatus() {
  try {
    const response = await apiRequest(`${URL}/jobs/jobStatus`);
    const jobStatuses = await response.json();
    const jobStatusDropdown = document.getElementById("updateJobStatus");
    
    // Clear existing options (except first one)
    jobStatusDropdown.innerHTML = '<option value="">Select Status</option>';
    
    jobStatuses.forEach(jobStatus => {
      const option = document.createElement("option");
      option.value = jobStatus;
      option.textContent = jobStatus;
      jobStatusDropdown.appendChild(option);
    });
  } catch (error) {
    console.error('Failed to load job statuses:', error);
    showMessage('jobMessage', 'Failed to load job statuses. Please refresh the page.');
  }
}

// Form validation
function validateProfileForm() {
  const name = document.getElementById('updateName').value.trim();
  const email = document.getElementById('updateEmail').value.trim();
  const pin = document.getElementById('updatePin').value;
  const role = document.getElementById('updateRole').value;
  
  if (!name) {
    showMessage('profileMessage', 'Name is required.');
    return false;
  }
  
  if (!email || !/\S+@\S+\.\S+/.test(email)) {
    showMessage('profileMessage', 'Please enter a valid email address.');
    return false;
  }
  
  if (!pin || pin < 1000 || pin > 9999) {
    showMessage('profileMessage', 'PIN must be a 4-digit number.');
    return false;
  }
  
  if (!role) {
    showMessage('profileMessage', 'Please select a role.');
    return false;
  }
  
  return true;
}

function validateJobForm() {
  const title = document.getElementById('jobTitle').value.trim();
  const company = document.getElementById('jobCompany').value.trim();
  const location = document.getElementById('jobLocation').value.trim();
  const status = document.getElementById('updateJobStatus').value;
  const description = document.getElementById('jobDescription').value.trim();
  
  if (!title) {
    showMessage('jobMessage', 'Job title is required.');
    return false;
  }
  
  if (!company) {
    showMessage('jobMessage', 'Company name is required.');
    return false;
  }
  
  if (!location) {
    showMessage('jobMessage', 'Job location is required.');
    return false;
  }
  
  if (!status) {
    showMessage('jobMessage', 'Please select a job status.');
    return false;
  }
  
  if (!description) {
    showMessage('jobMessage', 'Job description is required.');
    return false;
  }
  
  return true;
}

// Form handlers
document.getElementById('updateProfile').addEventListener('submit', async (e) => {
  e.preventDefault();
  
  if (!validateProfileForm()) return;
  
  showLoading('profileLoading', true);
  setFormEnabled('updateProfile', false);
  
  try {
    const formData = new URLSearchParams({
      name: document.getElementById('updateName').value.trim(),
      email: document.getElementById('updateEmail').value.trim(),
      pin: document.getElementById('updatePin').value,
      resume: document.getElementById('updateResume').value.trim(),
      userRole: document.getElementById('updateRole').value
    });
    
    const response = await apiRequest(`${AUTH_URL}/updateProfile`, {
      method: "POST",
      headers: { "Content-Type": "application/x-www-form-urlencoded" },
      body: formData
    });
    
    const result = await response.text();
    console.log('Profile update result:', result);
    
    showMessage('profileMessage', 'Profile updated successfully!', 'success');
    await getUserDetails(); // Refresh user info
    
  } catch (error) {
    console.error('Profile update failed:', error);
    showMessage('profileMessage', 'Failed to update profile. Please try again.');
  } finally {
    showLoading('profileLoading', false);
    setFormEnabled('updateProfile', true);
  }
});

document.getElementById('createJob').addEventListener('submit', async (e) => {
  e.preventDefault();
  
  if (!validateJobForm()) return;
  
  showLoading('jobLoading', true);
  setFormEnabled('createJob', false);
  
  try {
    const formData = new URLSearchParams({
      jobTitle: document.getElementById('jobTitle').value.trim(),
      jobDescription: document.getElementById('jobDescription').value.trim(),
      jobStatus: document.getElementById('updateJobStatus').value,
      jobLocation: document.getElementById('jobLocation').value.trim(),
      companyName: document.getElementById('jobCompany').value.trim()
    });
    
    const response = await apiRequest(`${URL}/jobs/createJob`, {
      method: "POST",
      headers: { "Content-Type": "application/x-www-form-urlencoded" },
      body: formData
    });
    
    const result = await response.text();
    console.log('Job creation result:', result);
    
    showMessage('jobMessage', 'Job created successfully!', 'success');
    
    // Clear form
    document.getElementById('createJob').reset();
    
  } catch (error) {
    console.error('Job creation failed:', error);
    showMessage('jobMessage', 'Failed to create job. Please try again.');
  } finally {
    showLoading('jobLoading', false);
    setFormEnabled('createJob', true);
  }
});

// Initialize on page load
window.addEventListener('load', async () => {
  try {
    await Promise.all([
      getUserRoles(),
      getUserDetails(),
      getJobStatus()
    ]);
  } catch (error) {
    console.error('Failed to initialize page:', error);
  }
});
</script>

</body>
</html>
